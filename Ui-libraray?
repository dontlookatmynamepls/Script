--// MoonLib v2 UI Library by Moonsec
--// Inspired by TurtleUI, ToraIsMeUI
--// Supports multi-window spawn & auto scrollbar

local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")

local MoonLib = {}
MoonLib.Windows = {}
MoonLib.Settings = {
    WindowGap = 10,
    StartPos = UDim2.new(0.05, 0, 0.1, 0),
    MaxElementsBeforeScroll = 10
}

-- Helper
local function CreateInstance(class, props)
    local obj = Instance.new(class)
    for i, v in pairs(props) do
        obj[i] = v
    end
    return obj
end

--// CREATE WINDOW
function MoonLib:CreateWindow(title, size)
    size = size or UDim2.new(0, 300, 0, 250)
    local totalWidth = 0
    for _, win in ipairs(self.Windows) do
        totalWidth += win.Frame.Size.X.Offset + self.Settings.WindowGap
    end

    local ScreenGui = CreateInstance("ScreenGui", {
        Name = "MoonLibUI_"..title,
        ResetOnSpawn = false,
        Parent = CoreGui
    })

    local Frame = CreateInstance("Frame", {
        Parent = ScreenGui,
        BackgroundColor3 = Color3.fromRGB(25, 25, 30),
        BorderSizePixel = 0,
        Size = size,
        Position = UDim2.new(0, totalWidth + 50, 0.1, 0),
        Draggable = true,
        Active = true
    })

    local TopBar = CreateInstance("Frame", {
        Parent = Frame,
        BackgroundColor3 = Color3.fromRGB(35, 35, 45),
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 30)
    })

    local TitleLabel = CreateInstance("TextLabel", {
        Parent = TopBar,
        Text = title or "Window",
        TextColor3 = Color3.fromRGB(255, 255, 255),
        BackgroundTransparency = 1,
        Font = Enum.Font.Gotham,
        TextSize = 14,
        Position = UDim2.new(0, 8, 0, 0),
        Size = UDim2.new(0.7, 0, 1, 0),
        TextXAlignment = Enum.TextXAlignment.Left
    })

    local MinimizeBtn = CreateInstance("TextButton", {
        Parent = TopBar,
        Text = "-",
        TextColor3 = Color3.fromRGB(255, 255, 255),
        BackgroundTransparency = 1,
        Font = Enum.Font.GothamBold,
        TextSize = 18,
        Size = UDim2.new(0, 25, 1, 0),
        Position = UDim2.new(1, -50, 0, 0)
    })

    local CloseBtn = CreateInstance("TextButton", {
        Parent = TopBar,
        Text = "Ã—",
        TextColor3 = Color3.fromRGB(255, 85, 85),
        BackgroundTransparency = 1,
        Font = Enum.Font.GothamBold,
        TextSize = 18,
        Size = UDim2.new(0, 25, 1, 0),
        Position = UDim2.new(1, -25, 0, 0)
    })

    local Main = CreateInstance("Frame", {
        Parent = Frame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, -30),
        Position = UDim2.new(0, 0, 0, 30)
    })

    local UIList = CreateInstance("UIListLayout", {
        Parent = Main,
        Padding = UDim.new(0, 5)
    })

    local Elements = 0
    local function CheckScroll()
        Elements += 1
        if Elements == MoonLib.Settings.MaxElementsBeforeScroll + 1 then
            -- convert to scroll frame
            local scroll = Instance.new("ScrollingFrame")
            scroll.Parent = Frame
            scroll.BackgroundTransparency = 1
            scroll.Size = Main.Size
            scroll.Position = Main.Position
            scroll.BorderSizePixel = 0
            scroll.CanvasSize = UDim2.new(0, 0, 0, 0)
            scroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
            scroll.ScrollBarThickness = 4
            scroll.ScrollBarImageColor3 = Color3.fromRGB(120, 120, 255)

            -- move old children
            for _, c in ipairs(Main:GetChildren()) do
                if not c:IsA("UIListLayout") then
                    c.Parent = scroll
                end
            end

            UIList.Parent = scroll
            Main:Destroy()
            Main = scroll
        end
    end

    --// BUTTON
    function Frame:Button(text, callback)
        CheckScroll()
        local btn = CreateInstance("TextButton", {
            Parent = Main,
            Text = text,
            BackgroundColor3 = Color3.fromRGB(45, 45, 55),
            BorderSizePixel = 0,
            TextColor3 = Color3.new(1, 1, 1),
            Size = UDim2.new(1, -10, 0, 28),
            Font = Enum.Font.Gotham,
            TextSize = 14
        })
        btn.MouseButton1Click:Connect(function()
            if callback then callback() end
        end)
    end

    --// LABEL
    function Frame:Label(text)
        CheckScroll()
        CreateInstance("TextLabel", {
            Parent = Main,
            Text = text,
            BackgroundTransparency = 1,
            TextColor3 = Color3.fromRGB(200, 200, 200),
            Font = Enum.Font.Gotham,
            TextSize = 13,
            Size = UDim2.new(1, -10, 0, 20)
        })
    end

    --// TOGGLE
    function Frame:Toggle(text, callback)
        CheckScroll()
        local toggle = false
        local btn = CreateInstance("TextButton", {
            Parent = Main,
            Text = text .. " [OFF]",
            BackgroundColor3 = Color3.fromRGB(45, 45, 55),
            BorderSizePixel = 0,
            TextColor3 = Color3.new(1, 1, 1),
            Size = UDim2.new(1, -10, 0, 28),
            Font = Enum.Font.Gotham,
            TextSize = 14
        })
        btn.MouseButton1Click:Connect(function()
            toggle = not toggle
            btn.Text = text .. (toggle and " [ON]" or " [OFF]")
            if callback then callback(toggle) end
        end)
    end

    --// DROPDOWN
    function Frame:Dropdown(title, list, callback)
        CheckScroll()
        local open = false
        local holder = CreateInstance("Frame", {
            Parent = Main,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, -10, 0, 30)
        })
        local mainBtn = CreateInstance("TextButton", {
            Parent = holder,
            Text = title,
            BackgroundColor3 = Color3.fromRGB(45, 45, 55),
            BorderSizePixel = 0,
            TextColor3 = Color3.new(1, 1, 1),
            Size = UDim2.new(1, 0, 1, 0),
            Font = Enum.Font.Gotham,
            TextSize = 14
        })

        local dropFrame = CreateInstance("Frame", {
            Parent = holder,
            BackgroundColor3 = Color3.fromRGB(30, 30, 40),
            Size = UDim2.new(1, 0, 0, 0),
            Position = UDim2.new(0, 0, 1, 0),
            BorderSizePixel = 0,
            ClipsDescendants = true
        })

        local layout = Instance.new("UIListLayout", dropFrame)

        for _, item in ipairs(list) do
            local opt = CreateInstance("TextButton", {
                Parent = dropFrame,
                Text = item,
                BackgroundColor3 = Color3.fromRGB(40, 40, 50),
                BorderSizePixel = 0,
                TextColor3 = Color3.new(1, 1, 1),
                Size = UDim2.new(1, 0, 0, 25),
                Font = Enum.Font.Gotham,
                TextSize = 13
            })
            opt.MouseButton1Click:Connect(function()
                mainBtn.Text = title .. ": " .. item
                if callback then callback(item) end
                open = false
                TweenService:Create(dropFrame, TweenInfo.new(0.2), {Size = UDim2.new(1, 0, 0, 0)}):Play()
            end)
        end

        mainBtn.MouseButton1Click:Connect(function()
            open = not open
            TweenService:Create(dropFrame, TweenInfo.new(0.2), {
                Size = open and UDim2.new(1, 0, 0, #list * 25) or UDim2.new(1, 0, 0, 0)
            }):Play()
        end)
    end

    --// IMAGE
    function Frame:Image(url)
        CheckScroll()
        local img = CreateInstance("ImageLabel", {
            Parent = Main,
            BackgroundTransparency = 1,
            Image = url or "rbxassetid://0",
            Size = UDim2.new(1, -10, 0, 100),
            ScaleType = Enum.ScaleType.Fit
        })
    end

    -- Close & Minimize
    CloseBtn.MouseButton1Click:Connect(function()
        ScreenGui:Destroy()
    end)

    local minimized = false
    MinimizeBtn.MouseButton1Click:Connect(function()
        minimized = not minimized
        TweenService:Create(Frame, TweenInfo.new(0.3), {
            Size = minimized and UDim2.new(0, size.X.Offset, 0, 30) or size
        }):Play()
    end)

    table.insert(self.Windows, {Frame = Frame, GUI = ScreenGui})
    return Frame
end

return MoonLib
